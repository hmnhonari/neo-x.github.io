---
layout: post
title: Animation/Simulation System flow of control
date: '2015-10-21T21:56:00.001-07:00'
author: Glen Berseth
summary: Simulation for animation is no easy task. There are many steps when constructing an animation and figuring out when particular data should be instantiated can be tricky. I am going to go over one method I have been using to help organize the steps and structure that could be used to construct the simulation flow of control.
tags: 
modified_time: '2015-10-22T20:34:56.269-07:00'
---

Simulation for animation is no easy task. There are many steps when constructing an animation and figuring out when particular data should be instantiated can be tricky. I am going to go over one method I have been using to help organize the steps and structure that could be used to construct the simulation flow of control.<br /><br /><br /><br /><br />This is for a Simulation Engine that I have been using in my work.<br /><br />The main steps in the Simulation engine <br /><ol><li>init() (allocating libraries and structures)</li><ol><li>Create empty data structures</li><li>Create spatial database</li><li>Create planning domain</li><li>Modules::init()</li><ol><li>Initialize any modules that are going to be used in the simulation</li></ol></ol><ol><li>At this point the libraries the user specified are loaded and some  global structures are created. Some examples of global structures are  the spatial database and the pathPlanning envirionment.</li><ol></ol></ol><li>initializeSimulation()</li><ol><li>Fill the global data structures</li><li>Add all the obstacles to the simulation (All Static geometry and items)</li><ol><li>Must be in place before agents are reset/initialized. </li></ol></ol><li>preprocessSimulation()</li><ol><li>Preconditions</li><ol><li>All obstacles should be loaded into the environment </li></ol><li>Preprocess all modules</li><li>refresh the planning domain</li><li>add agents to simulation&nbsp;</li><li>The simulation should be completely setup and ready for simulation. </li></ol><li>preprocessFrame()</li><ol><li>Store simulation data </li><li>Maybe you want to collect some data on the performance of the simulation </li></ol><li>update()</li><ol><li>Step all of the modules in the system </li></ol><li>postprocessFrame()</li><ol><li>Update metrics from preprocessFrame</li><li>Maybe save a picture or continue creating video </li></ol><li>postprocessSimulation()</li><ol><li>Collect data of metrics for simulation</li><li>Do not remove or clear data yet.&nbsp;</li><li>Maybe write out data to file.</li><li>This function is the best time to perform any kind of processing over data collected from the simulation.</li></ol><li>cleanupSimulation()</li><ol><li>Now data allocated data for the scenario can be reclaimed</li><li>Here is when the data structures can be emptied and delete before now that any data collected from the simulation has been processed.</li></ol><li>finish()</li><ol><li>Now simulation components can be deleted because no more simulation will be done.</li></ol></ol><br />I find this separation of allocating objects and data structures and creation of items that go in the data structures very helpful. In helps avoid accidentally accessing data structures before they are done being created. It also helps define the ordering in which types of objects should be added to the simulation. As with any software you never really know what is going to be done with it in the future and I think this structure covers many unseen possibilities.<br /><br /><ol></ol>