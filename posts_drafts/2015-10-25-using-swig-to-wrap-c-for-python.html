<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title> | Glen Berseth</title>
    <link rel="canonical" href="/posts_drafts/2015-10-25-using-swig-to-wrap-c-for-python">
    

    <meta property="og:title" content="">
    <meta property="og:url" content="/posts_drafts/2015-10-25-using-swig-to-wrap-c-for-python">
    <meta property="og:site_name" content="Glen Berseth">
    <meta name="twitter:card" content="summary">
    <meta property="twitter:title" content="">

	<script type="text/javascript" id="MathJax-script" async
	  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
	</script>
    <script type="application/ld+json">
    {"@type":"WebSite","headline":"Glen Berseth","url":"/","name":"Glen Berseth","@context":"https://schema.org"}</script>
    <!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css">
    <!-- <link rel="stylesheet" href="/assets/main.css"> --></head>
<body><header class="site-header">

    <div class="wrapper"><a class="site-title" rel="author" href="/">Glen Berseth</a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />
            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path d="M1.5 1.5 h15 M1.5 7.5 h15 M1.5 13.5 h15" stroke="black" stroke-width="3" stroke-linecap="round" />
                      </svg>
                </span>
            </label>

            <div class="trigger">
                    <a class="page-link" href="/">Home</a>
                
                    <a class="page-link" href="/people/">People</a>
                
                    <a class="page-link" href="/publications/">Publications</a>
                
                    <a class="page-link" href="/join/">Join Us</a>
                
                    <a class="page-link" href="/posts/">Posts</a>
                
                    <a class="page-link" href="/teaching/">Teaching</a>
                
                <a class="page-link" href="/fr/posts_drafts/2015-10-25-using-swig-to-wrap-c-for-python">Fr</a>
                
            </div>
        </nav></div>
    
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Using SWIG to wrap C++ for Python</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2015-10-25T22:25:00-04:00" itemprop="datePublished">Oct 25, 2015
      </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Glen Berseth</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h3>Intro </h3>
<p><br />In order to be able to access the C++ code from Python (or other languages) I have wrapped some of the functionality using SWIG (<a href="http://www.swig.org/">Simple Wrapper Interface Generator</a>). There is a short tutorial on <a href="http://www.swig.org/tutorial.html">this page</a> which covers some of the basics, however this is not enough. I am going to want to wrap far more complex data types and classes.<br /><br />&lt;h3&gt;Getting started&lt;/h3&gt;Starting with some code <br /><br /><br />&lt;pre&gt;<code><br />&nbsp;/* File : example.c<br />&nbsp; * Created by Glen Berseth<br />&nbsp; * date: Oct 25, 2015<br />&nbsp; *<br />&nbsp; * */<br />#include &lt;time .h=""&gt;<br />double My_variable = 3.0;<br />int fact(int n)<br />{<br />&nbsp;if (n &lt;= 1) return 1;<br />&nbsp;else return n*fact(n-1);<br />}<br />int my_mod(int x, int y)<br />{<br />&nbsp;return (x%y);<br />}<br />char * get_time()<br />{<br />&nbsp;time_t ltime;<br />&nbsp;time(&amp;ltime);<br />&nbsp;return ctime(&amp;ltime);<br />}<br /><br />&lt;/time&gt;</code>&lt;/pre&gt;&lt;pre&gt;<code><br /><br />/*<br />&nbsp;* Word.h<br />&nbsp;*<br />&nbsp;*&nbsp; Created on: 2015-10-25<br />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; author: gberseth<br />&nbsp;*/<br />#ifndef WORD_H_<br />#define WORD_H_<br /><br />#include <string><br /><br />class Word<br />{<br />public:<br />&nbsp;&nbsp;&nbsp; Word(std::string the_word);<br />&nbsp;&nbsp;&nbsp; virtual ~Word();<br /><br />&nbsp;&nbsp;&nbsp; virtual void updateWord(std::string word);<br />&nbsp;&nbsp;&nbsp; virtual std::string getWord();<br /><br />private:<br />&nbsp;&nbsp;&nbsp; std::string _the_word;<br />};<br /><br />#endif /* WORD_H_ */<br /><br /></string></code>&lt;/pre&gt;&lt;pre&gt;<code><br /><br />/*<br />&nbsp;* Word.cpp<br />&nbsp;*<br />&nbsp;*&nbsp; Created on: 2015-10-25<br />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; author: gberseth<br />&nbsp;*/<br />#include "Word.h"<br /><br />Word::Word(std::string the_word) :<br />&nbsp;&nbsp;&nbsp; _the_word(the_word)<br />{<br />&nbsp;&nbsp;&nbsp; // TODO Auto-generated constructor stub<br />}<br /><br />Word::~Word() {<br />&nbsp;&nbsp;&nbsp; // TODO Auto-generated destructor stub<br />}<br /><br />void Word::updateWord(std::string word)<br />{<br />&nbsp;&nbsp;&nbsp; this-&gt;_the_word = word;<br />}<br /><br />std::string Word::getWord()<br />{<br />&nbsp;&nbsp;&nbsp; return this-&gt;_the_word;<br />}<br /></code>&lt;/pre&gt;There are some global methods, some global variables and a class that uses a non C-like class <b>std::string</b>.<br />&lt;h4&gt;Create an Interface File&lt;/h4&gt;<br />An interface file is kind of like a header file but to be used specifically by swig. In the file you should include all of the methods/attributes/variables/header file you want to be exported. For example:<br /><br />&lt;pre&gt;<code><br />/* example.i */<br />%module example<br />&nbsp;%{<br />&nbsp;/* Put header files here or function declarations like below */<br />&nbsp;#include "example.h"<br />&nbsp;#include "Word.h"<br />&nbsp;%}<br /><br />&nbsp;%include "std_string.i" <br />&nbsp;%include "example.h"<br />&nbsp;%include "Word.h" <br /></code>&lt;/pre&gt;Note: to be able to use std::string properly you need to include the interface file for the class (std_string.i).<br /><br />This interface file includes both the header files for the methods and class(es) I want to be able to use in Python.<br /><br />&lt;h4&gt;Generating and Compiling&lt;/h4&gt;<br />I found this part to be the most confusing and difficult. SWIG can generate a enormous wrapper file that is almost unreadable and then you need to compile it. The errors you get from this process may not seem simple.<br /><br />&lt;ol&gt;&lt;li&gt;First generate the wrapper code <br /><br />&lt;pre&gt;<code>swig3.0 -c++ -python example.i<br /></code>&lt;/pre&gt;<br />Note: The <strong>-c++</strong> help because it tells SWIG what language is being wrapped, I think it might be C be default. &lt;/li&gt;&lt;li&gt;Compile the code <br /><br />&lt;pre&gt;<code>g++ -fpic -c example.h example_wrap.cxx Word.cpp -I/usr/include/python2.7/<br /></code>&lt;/pre&gt;<br />You need to add the include directory to that the compilation can find “Python.h”. &lt;/li&gt;&lt;li&gt;Link and Build <br />&lt;pre&gt;<code><br />gcc -shared example_wrap.o Word.o -o _example.so -lstdc++<br /></code>&lt;/pre&gt;&lt;/li&gt;&lt;/ol&gt;Linking gave me a rather difficult time. I was getting <strong>ImportError: ImportError:  undefined symbol: _ZTVN10__cxxabiv117__class_type_infoE</strong> errors in python when importing the library. This turned out to be caused by not including the stdc++ link file linking. After adding that link everthing works very nicely.<br /><br />&lt;h4&gt;Use in Python&lt;/h4&gt;<br />Using the library in python not might needs be so straightforward. In a more customary Python manner the first argument to a class method is the class object itself. This method is done manually in when using the generated Python code.<br /><br />&lt;pre&gt;<code><br />Python 2.7.6 (default, Mar 22 2014, 22:59:56) <br />[GCC 4.8.2] on linux2<br />Type "help", "copyright", "credits" or "license" for more information.<br />&gt;&gt;&gt; import _example<br />&gt;&gt;&gt; _example.new_Word("meat")<br />&lt;swig 0x7f25f211d7e0="" at="" object="" of="" ord="" type=""&gt;&gt;&gt;&gt; w = _example.new_Word("meat")<br />&gt;&gt;&gt; _example.Word_getWord(w)<br />'meat'<br />&gt;&gt;&gt; _example.Word_updateWord(w,"beef")<br />&gt;&gt;&gt; _example.Word_getWord(w)<br />'beef'<br />&gt;&gt;&gt; <br />&lt;/swig&gt;</code>&lt;/pre&gt;<br /><br />&lt;h3&gt;References  &lt;/h3&gt; 1. http://web.mit.edu/svn/src/swig-1.3.25/Examples/python/class/index.html<br /> 2. http://swig.10945.n7.nabble.com/Wrapping-static-library-in-Linux-td5112.html<br /> 3. http://www.swig.org/tutorial.html<br /> 4. http://intermediate-and-advanced-software-carpentry.readthedocs.org/en/latest/c++-wrapping.html</p>

  </div><a class="u-url" href="/posts_drafts/2015-10-25-using-swig-to-wrap-c-for-python" hidden></a>
</article>

        </div>
    </main><footer class="site-footer h-card">
    <data class="u-url" href="/%20/"></data>

    <div class="wrapper">
        

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list">
                    <li class="p-name">Glen Berseth</li></ul>
            </div>

            <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/neo-x"><svg
                class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#github"></use>
            </svg> <span class="username">neo-x</span></a></li><li><a
            href="https://www.linkedin.com/in/glen-berseth-0523278b"><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
            </svg> <span class="username">glen-berseth-0523278b</span></a></li><li><a
            href="https://www.twitter.com/GlenBerseth"><svg class="svg-icon">
                <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
            </svg> <span class="username">GlenBerseth</span></a></li><li><a rel="me"
            href="https://www.youtube.com/channel/UCOouaBg4gHIlNvPkJn_8ooA"
            title="Real Lab"><svg class="svg-icon grey">
                <use xlink:href="/assets/minima-social-icons.svg#youtube"></use>
            </svg> <span class="username">Real Lab</span></a></li></ul></div>

            <div class="footer-col footer-col-3">
                <p>I (he/him/il) am an assistant professor at the University de Montreal and Mila. My research explores how to use deep learning and reinforcement learning to develop generalist robots.</p>
            </div>
        </div>

    </div>

</footer></body>

</html>