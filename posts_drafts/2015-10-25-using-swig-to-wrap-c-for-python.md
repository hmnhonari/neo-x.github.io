---
layout: post
title: Using SWIG to wrap C++ for Python
date: '2015-10-25T19:25:00.001-07:00'
author: Glen Berseth
tags: 
summary: In order to be able to access the C++ code from Python (or other languages) I have wrapped some of the functionality using SWIG ([Simple Wrapper Interface Generator](http://www.swig.org/)). There is a short tutorial on [this page](http://www.swig.org/tutorial.html) which covers some of the basics, however this is not enough. I am going to want to wrap far more complex data types and classes.
modified_time: '2015-10-25T19:26:47.568-07:00'
blogger_id: tag:blogger.com,1999:blog-2030049895335802245.post-9081899229030898327
blogger_orig_url: http://fracturedplane.blogspot.com/2015/10/using-swig-to-wrap-c-for-python.html
---

<h3>Intro </h3><br />In order to be able to access the C++ code from Python (or other languages) I have wrapped some of the functionality using SWIG ([Simple Wrapper Interface Generator](http://www.swig.org/)). There is a short tutorial on [this page](http://www.swig.org/tutorial.html) which covers some of the basics, however this is not enough. I am going to want to wrap far more complex data types and classes.<br /><br /><h3>Getting started</h3>Starting with some code <br /><br /><br /><pre><code><br />&nbsp;/* File : example.c<br />&nbsp; * Created by Glen Berseth<br />&nbsp; * date: Oct 25, 2015<br />&nbsp; *<br />&nbsp; * */<br />#include <time .h=""><br />double My_variable = 3.0;<br />int fact(int n)<br />{<br />&nbsp;if (n &lt;= 1) return 1;<br />&nbsp;else return n*fact(n-1);<br />}<br />int my_mod(int x, int y)<br />{<br />&nbsp;return (x%y);<br />}<br />char * get_time()<br />{<br />&nbsp;time_t ltime;<br />&nbsp;time(&amp;ltime);<br />&nbsp;return ctime(&amp;ltime);<br />}<br /><br /></time></code></pre><pre><code><br /><br />/*<br />&nbsp;* Word.h<br />&nbsp;*<br />&nbsp;*&nbsp; Created on: 2015-10-25<br />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; author: gberseth<br />&nbsp;*/<br />#ifndef WORD_H_<br />#define WORD_H_<br /><br />#include <string><br /><br />class Word<br />{<br />public:<br />&nbsp;&nbsp;&nbsp; Word(std::string the_word);<br />&nbsp;&nbsp;&nbsp; virtual ~Word();<br /><br />&nbsp;&nbsp;&nbsp; virtual void updateWord(std::string word);<br />&nbsp;&nbsp;&nbsp; virtual std::string getWord();<br /><br />private:<br />&nbsp;&nbsp;&nbsp; std::string _the_word;<br />};<br /><br />#endif /* WORD_H_ */<br /><br /></string></code></pre><pre><code><br /><br />/*<br />&nbsp;* Word.cpp<br />&nbsp;*<br />&nbsp;*&nbsp; Created on: 2015-10-25<br />&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; author: gberseth<br />&nbsp;*/<br />#include "Word.h"<br /><br />Word::Word(std::string the_word) :<br />&nbsp;&nbsp;&nbsp; _the_word(the_word)<br />{<br />&nbsp;&nbsp;&nbsp; // TODO Auto-generated constructor stub<br />}<br /><br />Word::~Word() {<br />&nbsp;&nbsp;&nbsp; // TODO Auto-generated destructor stub<br />}<br /><br />void Word::updateWord(std::string word)<br />{<br />&nbsp;&nbsp;&nbsp; this-&gt;_the_word = word;<br />}<br /><br />std::string Word::getWord()<br />{<br />&nbsp;&nbsp;&nbsp; return this-&gt;_the_word;<br />}<br /></code></pre>There are some global methods, some global variables and a class that uses a non C-like class <b>std::string</b>.<br /><h4>Create an Interface File</h4><br />An interface file is kind of like a header file but to be used specifically by swig. In the file you should include all of the methods/attributes/variables/header file you want to be exported. For example:<br /><br /><pre><code><br />/* example.i */<br />%module example<br />&nbsp;%{<br />&nbsp;/* Put header files here or function declarations like below */<br />&nbsp;#include "example.h"<br />&nbsp;#include "Word.h"<br />&nbsp;%}<br /><br />&nbsp;%include "std_string.i" <br />&nbsp;%include "example.h"<br />&nbsp;%include "Word.h" <br /></code></pre>Note: to be able to use std::string properly you need to include the interface file for the class (std_string.i).<br /><br />This interface file includes both the header files for the methods and class(es) I want to be able to use in Python.<br /><br /><h4>Generating and Compiling</h4><br />I found this part to be the most confusing and difficult. SWIG can generate a enormous wrapper file that is almost unreadable and then you need to compile it. The errors you get from this process may not seem simple.<br /><br /><ol><li>First generate the wrapper code <br /><br /><pre><code>swig3.0 -c++ -python example.i<br /></code></pre><br />Note: The **-c++** help because it tells SWIG what language is being wrapped, I think it might be C be default.&nbsp;</li><li>Compile the code <br /><br /><pre><code>g++ -fpic -c example.h example_wrap.cxx Word.cpp -I/usr/include/python2.7/<br /></code></pre><br />You need to add the include directory to that the compilation can find "Python.h".&nbsp;</li><li>Link and Build <br /><pre><code><br />gcc -shared example_wrap.o Word.o -o _example.so -lstdc++<br /></code></pre></li></ol>Linking gave me a rather difficult time. I was getting **ImportError: ImportError:&nbsp; undefined symbol: _ZTVN10__cxxabiv117__class_type_infoE** errors in python when importing the library. This turned out to be caused by not including the stdc++ link file linking. After adding that link everthing works very nicely.<br /><br /><h4>Use in Python</h4><br />Using the library in python not might needs be so straightforward. In a more customary Python manner the first argument to a class method is the class object itself. This method is done manually in when using the generated Python code.<br /><br /><pre><code><br />Python 2.7.6 (default, Mar 22 2014, 22:59:56) <br />[GCC 4.8.2] on linux2<br />Type "help", "copyright", "credits" or "license" for more information.<br />&gt;&gt;&gt; import _example<br />&gt;&gt;&gt; _example.new_Word("meat")<br /><swig 0x7f25f211d7e0="" at="" object="" of="" ord="" type="">&gt;&gt;&gt; w = _example.new_Word("meat")<br />&gt;&gt;&gt; _example.Word_getWord(w)<br />'meat'<br />&gt;&gt;&gt; _example.Word_updateWord(w,"beef")<br />&gt;&gt;&gt; _example.Word_getWord(w)<br />'beef'<br />&gt;&gt;&gt; <br /></swig></code></pre><br /><br /><h3>References&nbsp; </h3>&nbsp;1. http://web.mit.edu/svn/src/swig-1.3.25/Examples/python/class/index.html<br />&nbsp;2. http://swig.10945.n7.nabble.com/Wrapping-static-library-in-Linux-td5112.html<br />&nbsp;3. http://www.swig.org/tutorial.html<br />&nbsp;4. http://intermediate-and-advanced-software-carpentry.readthedocs.org/en/latest/c++-wrapping.html