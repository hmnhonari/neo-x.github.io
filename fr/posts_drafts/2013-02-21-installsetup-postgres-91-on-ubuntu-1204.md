layout: post
title: Install/setup Postgres 9.1 on Ubuntu 12.04
date: '2013-02-21T19:05:00.001-08:00'
author: Glen B
tags: 
modified_time: '2013-03-16T18:23:43.266-07:00'
blogger_id: tag:blogger.com,1999:blog-2030049895335802245.post-3167132910732589143
blogger_orig_url: http://fracturedplane.blogspot.com/2013/02/installsetup-postgres-91-on-ubuntu-1204.html

Start by installing Postgres:<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo apt-get install postgresql<br /></code></pre><br /><br />After installing the first thing that needs to be done is adjust the connections postgres will accept. open the file /etc/postgresql/9.1/main/posrgresql.conf and turn on the listen addres<br /><br /><pre class="prettyprint"><code class="language-bash"><br />listen_addresses = 'localhost'<br /></code></pre><br /><br />Then turn password encryption on<br /><br /><pre class="prettyprint"><code class="language-bash"><br />password_encryption = on<br /></code></pre><br /><br />Then restart postgresql for these changes to take effect.<br /><br /><pre class="prettyprint"><code class="language-bash"><br />/etc/init.d/postgresql restart<br /></code></pre><br /><br />Now the server is ready to access. First thing to do is to create a database user to use for all of your work.<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo -u postgres createuser<br /><br />Enter name of role to add: username<br /><br />Shall the new role be a superuser? (y/n) n<br /><br />Shall the new role be allowed to create databases? (y/n) n<br /><br />Shall the new role be allowed to create more new roles? (y/n) n<br /><br /></code></pre><br />&nbsp;Then create the database you are going to use:<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo -u postgres createdb somedb<br /><br />CREATE DATABASE<br /></code></pre>After the database has been created a setup a password for that user and grant all privaleges for that user on the database.<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo -u postgres psql<br /><br />postgres=# alter user username with encrypted password 'passwd';<br /><br />ALTER ROLE<br /><br />postgres=# grant all privileges on database somedb to username;<br /><br />GRANT<br /><br /></code></pre><br /><br /><br />Now it is time to install the postgres client.<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo apt-get install postgresql-client<br /></code></pre><br /><br />Last it might be necessary to change the connection protocol in /etc/postgresql/9.1/main/pg_hba.conf. I was getting an error related to not having the privileges to access the database.<br /><br />On installation, your pg_hba.conf file will look like this:<br /><br /><br /><pre class="prettyprint"><code class="language-bash"><br /><span class="preprocessor">#&nbsp;TYPE&nbsp;&nbsp;DATABASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADDRESS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;METHOD</span>&nbsp;<br /><br /><br /><br /><span class="preprocessor">#&nbsp;"local"&nbsp;is&nbsp;for&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;connections&nbsp;only</span>&nbsp;<br /><br />local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;peer&nbsp;<br /><br /><span class="preprocessor">#&nbsp;IPv4&nbsp;local&nbsp;connections:</span>&nbsp;<br /><br />host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;<br /><br /><span class="preprocessor">#&nbsp;IPv6&nbsp;local&nbsp;connections:</span>&nbsp;<br /><br />host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::1/128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ident&nbsp;<br /><br /><span class="preprocessor">#&nbsp;Allow&nbsp;replication&nbsp;connections&nbsp;from&nbsp;localhost,&nbsp;by&nbsp;a&nbsp;user&nbsp;with&nbsp;the</span>&nbsp;<br /><br /><span class="preprocessor">#&nbsp;replication&nbsp;privilege.</span>&nbsp;<br /><br /><span class="preprocessor">#local&nbsp;&nbsp;&nbsp;replication&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postgres&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;peer</span>&nbsp;<br /><br /><span class="preprocessor">#host&nbsp;&nbsp;&nbsp;&nbsp;replication&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postgres&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ident</span>&nbsp;<br /><br /><span class="preprocessor">#host&nbsp;&nbsp;&nbsp;&nbsp;replication&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;postgres&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::1/128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ident</span>&nbsp;&nbsp;<br /></code></pre><br /><br />Change the METHOD to md5 as shown below:<br /><br /><pre class="prettyprint"><code class="language-bash"><br /><span class="preprocessor">#&nbsp;TYPE&nbsp;&nbsp;DATABASE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;USER&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ADDRESS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;METHOD</span>&nbsp;<br /><br /><br /><br /><span class="preprocessor">#&nbsp;"local"&nbsp;is&nbsp;for&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;connections&nbsp;only</span>&nbsp;<br /><br />local&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;md5&nbsp;<br /><br /><span class="preprocessor">#&nbsp;IPv4&nbsp;local&nbsp;connections:</span>&nbsp;<br /><br />host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1/32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;md5&nbsp;<br /><br /><span class="preprocessor">#&nbsp;IPv6&nbsp;local&nbsp;connections:</span>&nbsp;<br /><br />host&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;all&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;::1/128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;md5&nbsp;&nbsp;<br /></code></pre><br /><br />In order for the change to take effect, reload the pg_hba.conf file.<br /><pre class="prettyprint"><code class="language-bash"><br />sudo -u postgres psql<br /><br /><br />posgres=# select&nbsp;pg_reload_conf();&nbsp;&nbsp;<br /><br /><br /><br />&nbsp;pg_reload_conf&nbsp;<br /><br />----------------&nbsp;<br /><br />&nbsp;t&nbsp;<br /><br />(1&nbsp;row)&nbsp;<br /><br />&nbsp;<br /><br />postgres=#&nbsp;<br /></code></pre>Now it should be possible to connect to your database with&nbsp;   psql -d somedb -U username   It will ask you for your password.    If you want to create a tablespace for your database:   I just used the same hard-drive I installed it on, if you computer has more than one hard-drive you might want to distribute databases across table spaces. By default on Ubuntu postgres store the default tablespace in /var/lib/postgresql/9.1/main. You can double check this with the command  <br /><pre class="prettyprint"><code class="language-bash"><br />$ sudo -u postgres psql<br /><br />psql (9.1.7)<br /><br />Type "help" for help.<br /><br /><br /><br />postgres=# show data_directory;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data_directory&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br />------------------------------<br /><br />&nbsp;/var/lib/postgresql/9.1/main<br /><br />(1 row)<br /><br /><br /><br />postgres=#<br /></code></pre><br /><br />This next section gives direction on how to a table_space for postgres to store all of the information for table in a particular directory.<br /><br />You can just create a new directory in /var/lib/postgresql/9.1<br /><br /><pre class="prettyprint"><code class="language-bash"><br />sudo mkdir /var/lib/postgresql/9.1/somedir<br /><br /></code></pre><br />This will result in<br /><pre class="prettyprint"><code class="language-bash"><br />$ ls -la /var/lib/postgresql/9.1/<br /><br />total 16<br /><br />drwxr-xr-x&nbsp; 4 postgres postgres 4096 Feb 21 21:40 .<br /><br />drwxr-xr-x&nbsp; 3 postgres postgres 4096 Feb&nbsp; 7 12:05 ..<br /><br />drwx------ 13 postgres postgres 4096 Feb 21 20:43 main<br /><br />drwxr-xr-x&nbsp; 2 root&nbsp;&nbsp;&nbsp;&nbsp; root&nbsp;&nbsp;&nbsp;&nbsp; 4096 Feb 21 21:40 somedir<br /></code></pre><br /><br />The permissions need to be changed for postgres to be able to access the tablespace store correctly<br /><br /><pre class="prettyprint"><code class="language-bash"><br />$ sudo chown postgres /var/lib/postgresql/9.1/somedir<br /><br />$ sudo chgrp postgres /var/lib/postgresql/9.1/somedir<br /><br />$ ls -la /var/lib/postgresql/9.1/<br /><br />total 16<br /><br />drwxr-xr-x&nbsp; 4 postgres postgres 4096 Feb 21 21:40 .<br /><br />drwxr-xr-x&nbsp; 3 postgres postgres 4096 Feb&nbsp; 7 12:05 ..<br /><br />drwx------ 13 postgres postgres 4096 Feb 21 20:43 main<br /><br />drwxr-xr-x&nbsp; 2 postgres postgres 4096 Feb 21 21:40 somedir<br /></code></pre><br /><br />Now your tablespace has a home the postgres has access to. At this point there should be no issue in creating a new tablespace.<br /><br /><pre class="prettyprint"><code class="language-bash"><br />$ sudo -u postgres psql<br /><br />psql (9.1.7)<br /><br />Type "help" for help.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br /><br />postgres=# CREATE TABLESPACE table_store OWNER username&nbsp; LOCATION '/var/lib/postgresql/9.1/somedir/';<br /><br />CREATE TABLESPACE<br /><br />postgres=# <br /></code></pre><br /><br />All Set.<br /><br />References:<br /><ul><li>http://blog.lodeblomme.be/2008/03/15/move-a-postgresql-database-to-a-different-tablespace/</li><li>http://www.postgresql.org/docs/9.1/static/sql-commands.html</li><li>http://linuxpoison.blogspot.ca/2012/01/how-to-install-configure-postgresql.html</li><li>http://www.davidghedini.com/pg/entry/install_postgresql_9_on_centos</li></ul>